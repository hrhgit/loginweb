<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•é¡µè„šé”™è¯¯æ—¥å¿—åŠŸèƒ½</title>
    <style>
        body {
            font-family: 'Work Sans', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f7f3ec;
            color: #1f2421;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(18, 33, 30, 0.12);
        }
        .test-section {
            margin-bottom: 24px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.86);
            border-radius: 12px;
            border: 1px solid rgba(18, 33, 30, 0.06);
        }
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.18s ease;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .btn--primary {
            background: #1f6f6d;
            color: white;
        }
        .btn--primary:hover {
            transform: translateY(-1px);
        }
        .result {
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .error {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #ef4444;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>æµ‹è¯•é¡µè„šé”™è¯¯æ—¥å¿—åŠŸèƒ½</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ–°çš„é¡µè„šé”™è¯¯æ—¥å¿—åŠŸèƒ½ã€‚ç°åœ¨é”™è¯¯æ—¥å¿—å·²ç»ä»ä¸ªäººä¸»é¡µç§»åŠ¨åˆ°äº†é¡µé¢åº•éƒ¨ã€‚</p>

        <div class="test-section">
            <h3>æµ‹è¯•æ­¥éª¤</h3>
            <ol>
                <li>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ç”Ÿæˆä¸€äº›æµ‹è¯•é”™è¯¯è®°å½•</li>
                <li>æ‰“å¼€ä¸»åº”ç”¨ (http://localhost:5174)</li>
                <li>æŸ¥çœ‹é¡µé¢åº•éƒ¨çš„é¡µè„šï¼Œåº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªå°çš„é”™è¯¯æ—¥å¿—å›¾æ ‡</li>
                <li>ç‚¹å‡»é¡µè„šçš„é”™è¯¯æ—¥å¿—å›¾æ ‡ï¼Œåº”è¯¥èƒ½æ‰“å¼€é”™è¯¯æ—¥å¿—æ¨¡æ€æ¡†</li>
                <li>éªŒè¯é”™è¯¯æ—¥å¿—æ¨¡æ€æ¡†èƒ½æ­£å¸¸æ˜¾ç¤ºé”™è¯¯è®°å½•</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>1. ç”Ÿæˆæµ‹è¯•é”™è¯¯è®°å½•</h3>
            <button class="btn btn--primary" onclick="generateNetworkError()">ç”Ÿæˆç½‘ç»œé”™è¯¯</button>
            <button class="btn btn--primary" onclick="generateValidationError()">ç”ŸæˆéªŒè¯é”™è¯¯</button>
            <button class="btn btn--primary" onclick="generatePermissionError()">ç”Ÿæˆæƒé™é”™è¯¯</button>
            <button class="btn btn--primary" onclick="generateMultipleErrors()">ç”Ÿæˆå¤šä¸ªé”™è¯¯</button>
            <div id="generateResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>2. æŸ¥çœ‹é”™è¯¯è®°å½•</h3>
            <button class="btn btn--primary" onclick="viewErrorRecords()">æŸ¥çœ‹æœ¬åœ°é”™è¯¯è®°å½•</button>
            <button class="btn btn--primary" onclick="clearErrorRecords()">æ¸…é™¤é”™è¯¯è®°å½•</button>
            <div id="viewResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. æµ‹è¯•è¯´æ˜</h3>
            <p><strong>æ–°çš„é”™è¯¯æ—¥å¿—ä½ç½®ï¼š</strong></p>
            <ul>
                <li>âœ… é”™è¯¯æ—¥å¿—å·²ä»ä¸ªäººä¸»é¡µä¾§è¾¹æ ç§»é™¤</li>
                <li>âœ… é”™è¯¯æ—¥å¿—ç°åœ¨ä½äºé¡µé¢åº•éƒ¨é¡µè„šçš„å³ä¾§</li>
                <li>âœ… ä½¿ç”¨å°çš„è­¦å‘Šå›¾æ ‡ï¼Œä¸å¤ªèµ·çœ¼ä½†å®¹æ˜“æ‰¾åˆ°</li>
                <li>âœ… å³ä½¿ç”¨æˆ·æœªç™»å½•ä¹Ÿèƒ½è®¿é—®é”™è¯¯æ—¥å¿—</li>
                <li>âœ… ä¿æŒäº†åŸæœ‰çš„é”™è¯¯æ—¥å¿—åŠŸèƒ½</li>
            </ul>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿé”™è¯¯æ—¥å¿—ç®¡ç†å™¨çš„åŸºæœ¬åŠŸèƒ½
        class TestErrorLogManager {
            constructor() {
                this.STORAGE_KEY = 'error_log_records'
                this.MAX_RECORDS = 50
                this.MAX_STORAGE_SIZE = 1024 * 1024 // 1MB
            }

            addRecord(errorRecord) {
                try {
                    const records = this.getRecords()
                    
                    // æ·»åŠ æ—¶é—´æˆ³å’ŒID
                    const record = {
                        ...errorRecord,
                        id: `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent
                    }
                    
                    records.unshift(record)
                    
                    // é™åˆ¶è®°å½•æ•°é‡
                    if (records.length > this.MAX_RECORDS) {
                        records.splice(this.MAX_RECORDS)
                    }
                    
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(records))
                    return true
                } catch (error) {
                    console.error('æ·»åŠ é”™è¯¯è®°å½•å¤±è´¥:', error)
                    return false
                }
            }

            getRecords() {
                try {
                    const stored = localStorage.getItem(this.STORAGE_KEY)
                    return stored ? JSON.parse(stored) : []
                } catch (error) {
                    console.error('è·å–é”™è¯¯è®°å½•å¤±è´¥:', error)
                    return []
                }
            }

            clearRecords() {
                try {
                    localStorage.removeItem(this.STORAGE_KEY)
                    return true
                } catch (error) {
                    console.error('æ¸…é™¤é”™è¯¯è®°å½•å¤±è´¥:', error)
                    return false
                }
            }

            getStorageInfo() {
                const records = this.getRecords()
                const dataSize = new Blob([JSON.stringify(records)]).size
                
                return {
                    recordCount: records.length,
                    used: dataSize,
                    limit: this.MAX_STORAGE_SIZE
                }
            }
        }

        // åˆ›å»ºå…¨å±€å®ä¾‹
        window.testErrorLogManager = new TestErrorLogManager()

        // æµ‹è¯•å‡½æ•°
        window.generateNetworkError = function() {
            const error = {
                type: 'network',
                severity: 'error',
                message: 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®',
                originalError: {
                    name: 'NetworkError',
                    message: 'Failed to fetch',
                    code: 'NETWORK_ERROR'
                },
                context: {
                    operation: 'è·å–æ´»åŠ¨åˆ—è¡¨',
                    component: 'EventsPage',
                    url: '/api/events'
                }
            }
            
            const success = window.testErrorLogManager.addRecord(error)
            const resultDiv = document.getElementById('generateResult')
            resultDiv.style.display = 'block'
            resultDiv.className = success ? 'result success' : 'result error'
            resultDiv.textContent = success ? 'âœ… ç½‘ç»œé”™è¯¯å·²è®°å½•' : 'âŒ è®°å½•å¤±è´¥'
        }

        window.generateValidationError = function() {
            const error = {
                type: 'validation',
                severity: 'warning',
                message: 'ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥2-20ä¸ªå­—ç¬¦',
                originalError: {
                    name: 'ValidationError',
                    message: 'Username validation failed',
                    field: 'username'
                },
                context: {
                    operation: 'æ›´æ–°ä¸ªäººèµ„æ–™',
                    component: 'ProfilePage',
                    field: 'username'
                }
            }
            
            const success = window.testErrorLogManager.addRecord(error)
            const resultDiv = document.getElementById('generateResult')
            resultDiv.style.display = 'block'
            resultDiv.className = success ? 'result success' : 'result error'
            resultDiv.textContent = success ? 'âœ… éªŒè¯é”™è¯¯å·²è®°å½•' : 'âŒ è®°å½•å¤±è´¥'
        }

        window.generatePermissionError = function() {
            const error = {
                type: 'permission',
                severity: 'error',
                message: 'æƒé™ä¸è¶³ï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œæ­¤æ“ä½œ',
                originalError: {
                    name: 'PermissionError',
                    message: 'Insufficient permissions',
                    code: 'PERMISSION_DENIED'
                },
                context: {
                    operation: 'åˆ›å»ºæ´»åŠ¨',
                    component: 'CreateEventModal',
                    requiredRole: 'admin'
                }
            }
            
            const success = window.testErrorLogManager.addRecord(error)
            const resultDiv = document.getElementById('generateResult')
            resultDiv.style.display = 'block'
            resultDiv.className = success ? 'result success' : 'result error'
            resultDiv.textContent = success ? 'âœ… æƒé™é”™è¯¯å·²è®°å½•' : 'âŒ è®°å½•å¤±è´¥'
        }

        window.generateMultipleErrors = function() {
            const errors = [
                {
                    type: 'timeout',
                    severity: 'error',
                    message: 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•',
                    context: { operation: 'ä¸Šä¼ å¤´åƒ', component: 'AvatarCropper' }
                },
                {
                    type: 'server',
                    severity: 'error',
                    message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
                    context: { operation: 'ä¿å­˜é˜Ÿä¼ä¿¡æ¯', component: 'TeamCreatePage' }
                },
                {
                    type: 'client',
                    severity: 'warning',
                    message: 'æµè§ˆå™¨ä¸æ”¯æŒæ­¤åŠŸèƒ½',
                    context: { operation: 'æ–‡ä»¶ä¸Šä¼ ', component: 'SubmissionPage' }
                }
            ]
            
            let successCount = 0
            errors.forEach(error => {
                if (window.testErrorLogManager.addRecord(error)) {
                    successCount++
                }
            })
            
            const resultDiv = document.getElementById('generateResult')
            resultDiv.style.display = 'block'
            resultDiv.className = successCount === errors.length ? 'result success' : 'result error'
            resultDiv.textContent = `âœ… æˆåŠŸç”Ÿæˆ ${successCount}/${errors.length} æ¡é”™è¯¯è®°å½•`
        }

        window.viewErrorRecords = function() {
            const records = window.testErrorLogManager.getRecords()
            const storageInfo = window.testErrorLogManager.getStorageInfo()
            
            const resultDiv = document.getElementById('viewResult')
            resultDiv.style.display = 'block'
            resultDiv.className = 'result success'
            
            if (records.length === 0) {
                resultDiv.textContent = 'ğŸ“ æš‚æ— é”™è¯¯è®°å½•'
            } else {
                resultDiv.innerHTML = `
                    <strong>ğŸ“Š é”™è¯¯è®°å½•ç»Ÿè®¡ï¼š</strong><br>
                    è®°å½•æ•°é‡: ${storageInfo.recordCount}<br>
                    å­˜å‚¨ä½¿ç”¨: ${(storageInfo.used / 1024).toFixed(1)} KB / ${(storageInfo.limit / 1024).toFixed(0)} KB<br><br>
                    <strong>æœ€è¿‘çš„é”™è¯¯ï¼š</strong><br>
                    ${records.slice(0, 3).map(record => 
                        `â€¢ ${record.type}: ${record.message} (${new Date(record.timestamp).toLocaleString()})`
                    ).join('<br>')}
                    ${records.length > 3 ? `<br>... è¿˜æœ‰ ${records.length - 3} æ¡è®°å½•` : ''}
                `
            }
        }

        window.clearErrorRecords = function() {
            if (!confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰é”™è¯¯è®°å½•å—ï¼Ÿ')) {
                return
            }
            
            const success = window.testErrorLogManager.clearRecords()
            const resultDiv = document.getElementById('viewResult')
            resultDiv.style.display = 'block'
            resultDiv.className = success ? 'result success' : 'result error'
            resultDiv.textContent = success ? 'âœ… æ‰€æœ‰é”™è¯¯è®°å½•å·²æ¸…é™¤' : 'âŒ æ¸…é™¤å¤±è´¥'
        }
    </script>
</body>
</html>