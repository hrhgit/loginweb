<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生成测试错误记录</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: #e6ffe6; color: #080; }
        .error { background: #ffe6e6; color: #d00; }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        button:hover { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>生成测试错误记录</h1>
    <p>这个页面用于生成一些测试错误记录，然后你可以在个人中心的错误日志中查看它们。</p>

    <div class="test-section">
        <h3>生成测试错误</h3>
        <button onclick="generateTestErrors()">生成5条测试错误记录</button>
        <button onclick="clearErrors()">清除所有错误记录</button>
        <div id="result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>使用说明</h3>
        <ol>
            <li>点击"生成5条测试错误记录"按钮</li>
            <li>打开个人中心页面（/me/profile）</li>
            <li>点击左侧导航栏中的"错误日志"按钮</li>
            <li>查看是否能正常显示错误日志模态框</li>
        </ol>
    </div>

    <script>
        function generateTestErrors() {
            const resultDiv = document.getElementById('result')
            
            try {
                const STORAGE_KEY = 'error_log_records'
                
                // 生成测试错误记录
                const testErrors = [
                    {
                        id: `error_${Date.now()}_1`,
                        timestamp: new Date(),
                        type: 'network',
                        severity: 'warning',
                        message: '网络连接失败，请检查网络后重试',
                        originalError: { message: 'Failed to fetch', code: 'NETWORK_ERROR' },
                        context: {
                            operation: 'login',
                            component: 'auth'
                        },
                        retryCount: 0,
                        userAgent: navigator.userAgent
                    },
                    {
                        id: `error_${Date.now()}_2`,
                        timestamp: new Date(Date.now() - 60000), // 1分钟前
                        type: 'permission',
                        severity: 'fatal',
                        message: '权限不足，请联系管理员',
                        originalError: { message: 'Forbidden', code: '403' },
                        context: {
                            operation: 'delete',
                            component: 'event'
                        },
                        retryCount: 0,
                        userAgent: navigator.userAgent
                    },
                    {
                        id: `error_${Date.now()}_3`,
                        timestamp: new Date(Date.now() - 120000), // 2分钟前
                        type: 'validation',
                        severity: 'warning',
                        message: '输入信息有误，请检查后重试',
                        originalError: { message: 'Validation failed: username is required' },
                        context: {
                            operation: 'register',
                            component: 'form'
                        },
                        retryCount: 0,
                        userAgent: navigator.userAgent
                    },
                    {
                        id: `error_${Date.now()}_4`,
                        timestamp: new Date(Date.now() - 300000), // 5分钟前
                        type: 'timeout',
                        severity: 'warning',
                        message: '操作超时，请稍后重试',
                        originalError: { message: 'Request timeout', code: 'TIMEOUT' },
                        context: {
                            operation: 'upload',
                            component: 'file'
                        },
                        retryCount: 2,
                        userAgent: navigator.userAgent
                    },
                    {
                        id: `error_${Date.now()}_5`,
                        timestamp: new Date(Date.now() - 600000), // 10分钟前
                        type: 'server',
                        severity: 'fatal',
                        message: '服务器暂时不可用，请稍后重试',
                        originalError: { message: 'Internal Server Error', code: '500' },
                        context: {
                            operation: 'save',
                            component: 'profile'
                        },
                        retryCount: 1,
                        userAgent: navigator.userAgent
                    }
                ]
                
                // 保存到localStorage
                localStorage.setItem(STORAGE_KEY, JSON.stringify(testErrors))
                
                resultDiv.className = 'result success'
                resultDiv.textContent = `✅ 成功生成 ${testErrors.length} 条测试错误记录！现在可以去个人中心查看错误日志了。`
                
            } catch (error) {
                resultDiv.className = 'result error'
                resultDiv.textContent = `❌ 生成测试错误失败: ${error.message}`
            }
        }

        function clearErrors() {
            const resultDiv = document.getElementById('result')
            
            try {
                const STORAGE_KEY = 'error_log_records'
                localStorage.removeItem(STORAGE_KEY)
                
                resultDiv.className = 'result success'
                resultDiv.textContent = '✅ 已清除所有错误记录'
                
            } catch (error) {
                resultDiv.className = 'result error'
                resultDiv.textContent = `❌ 清除失败: ${error.message}`
            }
        }

        // 页面加载时显示当前状态
        window.addEventListener('load', () => {
            const STORAGE_KEY = 'error_log_records'
            const stored = localStorage.getItem(STORAGE_KEY)
            const resultDiv = document.getElementById('result')
            
            if (stored) {
                try {
                    const records = JSON.parse(stored)
                    resultDiv.className = 'result'
                    resultDiv.textContent = `当前有 ${records.length} 条错误记录`
                } catch (e) {
                    resultDiv.className = 'result'
                    resultDiv.textContent = '当前没有有效的错误记录'
                }
            } else {
                resultDiv.className = 'result'
                resultDiv.textContent = '当前没有错误记录'
            }
        })
    </script>
</body>
</html>