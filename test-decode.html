<!DOCTYPE html>
<html>
<head>
    <title>文件名解码测试</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>文件名解码测试</h1>
    <div id="results"></div>

    <script>
        const decodeFileName = (encodedFileName) => {
            try {
                console.log('开始解码文件名:', encodedFileName)
                
                // 分离文件名和扩展名
                const lastDotIndex = encodedFileName.lastIndexOf('.')
                const encodedName = lastDotIndex > 0 ? encodedFileName.substring(0, lastDotIndex) : encodedFileName
                const ext = lastDotIndex > 0 ? encodedFileName.substring(lastDotIndex) : ''
                
                console.log('分离结果:', { encodedName, ext })
                
                // 检查是否是编码格式（包含下划线）
                if (!encodedName.includes('_')) {
                    console.log('文件名未编码，直接返回')
                    return encodedFileName
                }
                
                // 反向转换编码：下划线还原为%
                const withPercent = encodedName.replace(/_/g, '%')
                console.log('还原%符号:', withPercent)
                
                // URL解码
                const decodedName = decodeURIComponent(withPercent)
                console.log('解码结果:', decodedName)
                
                const finalName = decodedName + ext
                console.log('最终文件名:', finalName)
                
                return finalName
            } catch (error) {
                console.error('解码文件名失败:', error)
                return encodedFileName
            }
        }

        // 测试用例
        const testCases = [
            '_E6_B5_8B_E8_AF_95.zip',
            '_E5_9B_BE_E7_89_871.png',
            'normal-file.txt'
        ]

        const results = document.getElementById('results')
        
        testCases.forEach(testCase => {
            const decoded = decodeFileName(testCase)
            results.innerHTML += `
                <p><strong>原文件名:</strong> ${testCase}</p>
                <p><strong>解码后:</strong> ${decoded}</p>
                <hr>
            `
        })
    </script>
</body>
</html>