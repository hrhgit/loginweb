<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>存储桶调试工具</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supabase 存储桶调试工具</h1>
    
    <div>
        <h2>测试存储桶连接</h2>
        <button onclick="testStorageBuckets()">测试存储桶</button>
        <button onclick="testFileUrl()">测试文件URL生成</button>
    </div>
    
    <div id="results" style="margin-top: 20px; padding: 10px; background: #f5f5f5; white-space: pre-wrap;"></div>

    <script>
        // 初始化 Supabase 客户端
        const supabaseUrl = 'https://whnetfkhvuhcavvojjxa.supabase.co'
        const supabaseKey = 'sb_publishable_vzBphiRwGub1_cRAjiVDPg_OVB89HxF'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        const log = (message) => {
            const results = document.getElementById('results')
            results.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n'
        }
        
        async function testStorageBuckets() {
            log('开始测试存储桶...')
            
            try {
                // 列出所有存储桶
                const { data: buckets, error } = await supabase.storage.listBuckets()
                
                if (error) {
                    log('获取存储桶列表失败: ' + error.message)
                    return
                }
                
                log('存储桶列表:')
                buckets.forEach(bucket => {
                    log(`- ${bucket.id} (public: ${bucket.public})`)
                })
                
                // 检查 submission-files 存储桶
                const submissionBucket = buckets.find(b => b.id === 'submission-files')
                if (submissionBucket) {
                    log('✅ submission-files 存储桶存在')
                    log(`   公开访问: ${submissionBucket.public}`)
                } else {
                    log('❌ submission-files 存储桶不存在')
                }
                
            } catch (err) {
                log('测试存储桶时出错: ' + err.message)
            }
        }
        
        async function testFileUrl() {
            log('测试文件URL生成...')
            
            // 测试路径（你需要替换为实际的文件路径）
            const testPath = 'files/test-event/test-team-123456.zip'
            
            try {
                const { data } = supabase.storage.from('submission-files').getPublicUrl(testPath)
                log('生成的URL: ' + data.publicUrl)
                
                // 测试URL是否可访问
                const response = await fetch(data.publicUrl, { method: 'HEAD' })
                log(`URL状态: ${response.status} ${response.statusText}`)
                
            } catch (err) {
                log('测试URL时出错: ' + err.message)
            }
        }
    </script>
</body>
</html>
</html>